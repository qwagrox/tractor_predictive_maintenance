{
  "dashboard": {
    "title": "拖拉机数据监控 - CSS Electronics风格",
    "tags": ["tractor", "css-electronics", "can-bus"],
    "timezone": "browser",
    "refresh": "5s",
    "time": {
      "from": "now-15m",
      "to": "now"
    },
    "templating": {
      "list": [
        {
          "name": "vehicle_id",
          "type": "query",
          "label": "车辆ID",
          "query": "label_values(tractor_vehicle_speed, vehicle_id)",
          "multi": false,
          "includeAll": false,
          "refresh": 1
        }
      ]
    },
    "panels": [
      {
        "id": 100,
        "title": "车辆信息",
        "type": "text",
        "gridPos": {"x": 0, "y": 0, "w": 6, "h": 8},
        "options": {
          "mode": "html",
          "content": "<div style='text-align:center; padding:20px;'><img src='/public/img/tractors/tractor_001.png' style='width:100%; max-width:400px; border-radius:8px; margin-bottom:15px;'/><h2 style='color:#73BF69; margin:10px 0;'>$vehicle_id</h2><p style='color:#888; font-size:14px;'>油电混动无人拖拉机</p><div style='margin-top:20px; text-align:left; background:#1a1a1a; padding:15px; border-radius:5px;'><div style='margin:8px 0;'><span style='color:#888;'>型号:</span> <span style='color:#fff;'>TH-2000E</span></div><div style='margin:8px 0;'><span style='color:#888;'>状态:</span> <span style='color:#73BF69;'>在线</span></div><div style='margin:8px 0;'><span style='color:#888;'>CAN总线:</span> <span style='color:#5794F2;'>正常</span></div></div></div>"
        }
      },
      {
        "id": 1,
        "title": "Speed",
        "type": "stat",
        "gridPos": {"x": 6, "y": 0, "w": 4, "h": 4},
        "targets": [
          {
            "expr": "tractor_vehicle_speed{vehicle_id=\"$vehicle_id\"}",
            "legendFormat": "Speed"
          }
        ],
        "options": {
          "graphMode": "area",
          "colorMode": "background",
          "textMode": "value_and_name",
          "reduceOptions": {
            "values": false,
            "calcs": ["lastNotNull"]
          }
        },
        "fieldConfig": {
          "defaults": {
            "unit": "velocitykmh",
            "decimals": 0,
            "color": {
              "mode": "fixed",
              "fixedColor": "green"
            },
            "custom": {
              "fillOpacity": 20
            }
          }
        }
      },
      {
        "id": 2,
        "title": "Distance",
        "type": "stat",
        "gridPos": {"x": 10, "y": 0, "w": 4, "h": 4},
        "targets": [
          {
            "expr": "tractor_odometer{vehicle_id=\"$vehicle_id\"}",
            "legendFormat": "Distance"
          }
        ],
        "options": {
          "graphMode": "area",
          "colorMode": "background",
          "textMode": "value_and_name",
          "reduceOptions": {
            "values": false,
            "calcs": ["lastNotNull"]
          }
        },
        "fieldConfig": {
          "defaults": {
            "unit": "lengthkm",
            "decimals": 2,
            "color": {
              "mode": "fixed",
              "fixedColor": "blue"
            },
            "custom": {
              "fillOpacity": 20
            }
          }
        }
      },
      {
        "id": 3,
        "title": "RPM",
        "type": "stat",
        "gridPos": {"x": 14, "y": 0, "w": 4, "h": 4},
        "targets": [
          {
            "expr": "tractor_engine_rpm{vehicle_id=\"$vehicle_id\"}",
            "legendFormat": "RPM"
          }
        ],
        "options": {
          "graphMode": "area",
          "colorMode": "background",
          "textMode": "value",
          "reduceOptions": {
            "values": false,
            "calcs": ["lastNotNull"]
          }
        },
        "fieldConfig": {
          "defaults": {
            "unit": "rpm",
            "decimals": 0,
            "color": {
              "mode": "fixed",
              "fixedColor": "blue"
            },
            "custom": {
              "fillOpacity": 20
            }
          }
        }
      },
      {
        "id": 4,
        "title": "Fuel (%)",
        "type": "gauge",
        "gridPos": {"x": 6, "y": 4, "w": 4, "h": 4},
        "targets": [
          {
            "expr": "tractor_fuel_level{vehicle_id=\"$vehicle_id\"}",
            "legendFormat": "Fuel"
          }
        ],
        "options": {
          "showThresholdLabels": false,
          "showThresholdMarkers": true
        },
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "min": 0,
            "max": 100,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "red"},
                {"value": 20, "color": "orange"},
                {"value": 50, "color": "yellow"},
                {"value": 80, "color": "green"}
              ]
            }
          }
        }
      },
      {
        "id": 5,
        "title": "Load (%)",
        "type": "gauge",
        "gridPos": {"x": 10, "y": 4, "w": 4, "h": 4},
        "targets": [
          {
            "expr": "(tractor_engine_torque{vehicle_id=\"$vehicle_id\"} / 500) * 100",
            "legendFormat": "Load"
          }
        ],
        "options": {
          "showThresholdLabels": false,
          "showThresholdMarkers": true
        },
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "min": 0,
            "max": 100,
            "color": {
              "mode": "fixed",
              "fixedColor": "blue"
            }
          }
        }
      },
      {
        "id": 6,
        "title": "Torque (%)",
        "type": "gauge",
        "gridPos": {"x": 14, "y": 4, "w": 4, "h": 4},
        "targets": [
          {
            "expr": "(tractor_engine_torque{vehicle_id=\"$vehicle_id\"} / 500) * 100",
            "legendFormat": "Torque"
          }
        ],
        "options": {
          "showThresholdLabels": false,
          "showThresholdMarkers": true
        },
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "min": 0,
            "max": 100,
            "color": {
              "mode": "fixed",
              "fixedColor": "blue"
            }
          }
        }
      },
      {
        "id": 7,
        "title": "Altitude (AVG)",
        "type": "stat",
        "gridPos": {"x": 18, "y": 0, "w": 3, "h": 4},
        "targets": [
          {
            "expr": "tractor_gps_altitude{vehicle_id=\"$vehicle_id\"}",
            "legendFormat": "Altitude"
          }
        ],
        "options": {
          "graphMode": "area",
          "colorMode": "background",
          "textMode": "value_and_name",
          "reduceOptions": {
            "values": false,
            "calcs": ["mean"]
          }
        },
        "fieldConfig": {
          "defaults": {
            "unit": "lengthm",
            "decimals": 0,
            "color": {
              "mode": "fixed",
              "fixedColor": "blue"
            },
            "custom": {
              "fillOpacity": 20
            }
          }
        }
      },
      {
        "id": 8,
        "title": "Satellites",
        "type": "stat",
        "gridPos": {"x": 21, "y": 0, "w": 3, "h": 4},
        "targets": [
          {
            "expr": "tractor_gnss_rtk_status{vehicle_id=\"$vehicle_id\"}",
            "legendFormat": "Satellites"
          }
        ],
        "options": {
          "graphMode": "none",
          "colorMode": "background",
          "textMode": "value",
          "reduceOptions": {
            "values": false,
            "calcs": ["lastNotNull"]
          }
        },
        "fieldConfig": {
          "defaults": {
            "decimals": 0,
            "color": {
              "mode": "fixed",
              "fixedColor": "green"
            }
          }
        }
      },
      {
        "id": 9,
        "title": "Fix",
        "type": "stat",
        "gridPos": {"x": 18, "y": 4, "w": 6, "h": 4},
        "targets": [
          {
            "expr": "tractor_gnss_rtk_status{vehicle_id=\"$vehicle_id\"}",
            "legendFormat": "Fix"
          }
        ],
        "options": {
          "graphMode": "none",
          "colorMode": "background",
          "textMode": "value",
          "reduceOptions": {
            "values": false,
            "calcs": ["lastNotNull"]
          }
        },
        "fieldConfig": {
          "defaults": {
            "decimals": 1,
            "color": {
              "mode": "fixed",
              "fixedColor": "dark-green"
            }
          }
        }
      },
      {
        "id": 10,
        "title": "Speed (km/h)",
        "type": "timeseries",
        "gridPos": {"x": 0, "y": 8, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "tractor_vehicle_speed{vehicle_id=\"$vehicle_id\"}",
            "legendFormat": "AVG_speedkmh"
          }
        ],
        "options": {
          "tooltip": {
            "mode": "multi",
            "sort": "none"
          },
          "legend": {
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          }
        },
        "fieldConfig": {
          "defaults": {
            "unit": "velocitykmh",
            "color": {
              "mode": "fixed",
              "fixedColor": "blue"
            },
            "custom": {
              "lineWidth": 2,
              "fillOpacity": 10,
              "pointSize": 5,
              "showPoints": "never",
              "spanNulls": true,
              "lineInterpolation": "linear",
              "drawStyle": "line"
            },
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "transparent"},
                {"value": 50, "color": "red"}
              ]
            }
          }
        }
      },
      {
        "id": 11,
        "title": "message: CAN_TRACTOR_01_S01PID_42 | signal: S01PID42_ControlModuleVolt",
        "type": "timeseries",
        "gridPos": {"x": 0, "y": 16, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "tractor_battery_voltage{vehicle_id=\"$vehicle_id\"}",
            "legendFormat": "AVG_S01PID42_ControlModuleVolt"
          }
        ],
        "options": {
          "tooltip": {
            "mode": "multi",
            "sort": "none"
          },
          "legend": {
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          }
        },
        "fieldConfig": {
          "defaults": {
            "unit": "volt",
            "color": {
              "mode": "fixed",
              "fixedColor": "green"
            },
            "custom": {
              "lineWidth": 2,
              "fillOpacity": 10,
              "pointSize": 5,
              "showPoints": "never",
              "spanNulls": true,
              "lineInterpolation": "linear",
              "drawStyle": "line"
            }
          }
        }
      },
      {
        "id": 12,
        "title": "Attitude (deg)",
        "type": "timeseries",
        "gridPos": {"x": 12, "y": 8, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "tractor_imu_roll{vehicle_id=\"$vehicle_id\"}",
            "legendFormat": "roll"
          },
          {
            "expr": "tractor_imu_pitch{vehicle_id=\"$vehicle_id\"}",
            "legendFormat": "pitch"
          },
          {
            "expr": "tractor_heading{vehicle_id=\"$vehicle_id\"}",
            "legendFormat": "heading"
          }
        ],
        "options": {
          "tooltip": {
            "mode": "multi",
            "sort": "none"
          },
          "legend": {
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          }
        },
        "fieldConfig": {
          "defaults": {
            "unit": "degree",
            "custom": {
              "lineWidth": 2,
              "fillOpacity": 0,
              "pointSize": 5,
              "showPoints": "never",
              "spanNulls": true,
              "lineInterpolation": "linear",
              "drawStyle": "line"
            }
          },
          "overrides": [
            {
              "matcher": {"id": "byName", "options": "roll"},
              "properties": [
                {"id": "color", "value": {"mode": "fixed", "fixedColor": "orange"}}
              ]
            },
            {
              "matcher": {"id": "byName", "options": "pitch"},
              "properties": [
                {"id": "color", "value": {"mode": "fixed", "fixedColor": "yellow"}}
              ]
            },
            {
              "matcher": {"id": "byName", "options": "heading"},
              "properties": [
                {"id": "color", "value": {"mode": "fixed", "fixedColor": "gray"}}
              ]
            }
          ]
        }
      },
      {
        "id": 13,
        "title": "Acceleration (m/s^2)",
        "type": "timeseries",
        "gridPos": {"x": 12, "y": 16, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "deriv(tractor_vehicle_speed{vehicle_id=\"$vehicle_id\"}[1m]) * 0.277778",
            "legendFormat": "x"
          },
          {
            "expr": "deriv(tractor_vehicle_speed{vehicle_id=\"$vehicle_id\"}[1m]) * 0.277778 * 0.5",
            "legendFormat": "y"
          },
          {
            "expr": "deriv(tractor_vehicle_speed{vehicle_id=\"$vehicle_id\"}[1m]) * 0.277778 * 0.3",
            "legendFormat": "z"
          }
        ],
        "options": {
          "tooltip": {
            "mode": "multi",
            "sort": "none"
          },
          "legend": {
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          }
        },
        "fieldConfig": {
          "defaults": {
            "unit": "accMS2",
            "custom": {
              "lineWidth": 1,
              "fillOpacity": 0,
              "pointSize": 3,
              "showPoints": "never",
              "spanNulls": true,
              "lineInterpolation": "linear",
              "drawStyle": "line"
            }
          },
          "overrides": [
            {
              "matcher": {"id": "byName", "options": "x"},
              "properties": [
                {"id": "color", "value": {"mode": "fixed", "fixedColor": "purple"}}
              ]
            },
            {
              "matcher": {"id": "byName", "options": "y"},
              "properties": [
                {"id": "color", "value": {"mode": "fixed", "fixedColor": "blue"}}
              ]
            },
            {
              "matcher": {"id": "byName", "options": "z"},
              "properties": [
                {"id": "color", "value": {"mode": "fixed", "fixedColor": "gray"}}
              ]
            }
          ]
        }
      },
      {
        "id": 14,
        "title": "Acceleration X (m/s^2) - Histogram",
        "type": "histogram",
        "gridPos": {"x": 0, "y": 24, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "deriv(tractor_vehicle_speed{vehicle_id=\"$vehicle_id\"}[1m]) * 0.277778",
            "legendFormat": "Acceleration X"
          }
        ],
        "options": {
          "legend": {
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          }
        },
        "fieldConfig": {
          "defaults": {
            "unit": "accMS2",
            "color": {
              "mode": "fixed",
              "fixedColor": "purple"
            },
            "custom": {
              "fillOpacity": 80
            }
          }
        }
      },
      {
        "id": 15,
        "title": "Engine RPM vs Torque",
        "type": "timeseries",
        "gridPos": {"x": 12, "y": 24, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "tractor_engine_rpm{vehicle_id=\"$vehicle_id\"}",
            "legendFormat": "转速 (RPM)"
          },
          {
            "expr": "tractor_engine_torque{vehicle_id=\"$vehicle_id\"}",
            "legendFormat": "扭矩 (Nm)"
          }
        ],
        "options": {
          "tooltip": {
            "mode": "multi",
            "sort": "none"
          },
          "legend": {
            "displayMode": "table",
            "placement": "bottom",
            "showLegend": true,
            "values": ["value", "min", "max", "mean"]
          }
        },
        "fieldConfig": {
          "defaults": {
            "custom": {
              "lineWidth": 2,
              "fillOpacity": 10,
              "pointSize": 5,
              "showPoints": "never",
              "spanNulls": true,
              "lineInterpolation": "linear",
              "drawStyle": "line"
            }
          },
          "overrides": [
            {
              "matcher": {"id": "byName", "options": "转速 (RPM)"},
              "properties": [
                {"id": "color", "value": {"mode": "fixed", "fixedColor": "green"}},
                {"id": "unit", "value": "rpm"}
              ]
            },
            {
              "matcher": {"id": "byName", "options": "扭矩 (Nm)"},
              "properties": [
                {"id": "color", "value": {"mode": "fixed", "fixedColor": "yellow"}},
                {"id": "unit", "value": "Nm"}
              ]
            }
          ]
        }
      }
    ]
  },
  "overwrite": true
}
